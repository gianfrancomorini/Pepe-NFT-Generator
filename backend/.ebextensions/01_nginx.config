files:
     "/etc/nginx/conf.d/cors.conf":
       mode: "000644"
       owner: root
       group: root
       content: |
         server {
           listen 80;
           if ($time_iso8601 ~ "^(\d{4})-(\d{2})-(\d{2})T(\d{2})") {
             set $year $1;
             set $month $2;
             set $day $3;
             set $hour $4;
           }
           access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;
           
           location / {
             proxy_pass http://docker;
             proxy_http_version 1.1;
             proxy_set_header Upgrade $http_upgrade;
             proxy_set_header Connection "upgrade";
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             
             add_header 'Access-Control-Allow-Origin' 'https://gianfrancomorini.github.io' always;
             add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
             add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range' always;
             add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
           }
         }

   container_commands:
     01_reload_nginx:
       command: "service nginx reload"